<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="bluetooth=*">
    <title>ProPart Diagnostic Pro - Sistema Completo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .header h1 { font-size: 1.8em; margin-bottom: 8px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .card h2 { color: #667eea; margin-bottom: 20px; }
        .status-box {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin: 20px 0;
            border-left: 6px solid #667eea;
        }
        .status-box.connected {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }
        button {
            padding: 16px;
            font-size: 1.05em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin: 8px 0;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: linear-gradient(135deg, #4CAF50, #45a049); color: white; }
        .btn-danger { background: linear-gradient(135deg, #f44336, #da190b); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ff9800, #fb8c00); color: white; }
        
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .sensor-card {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        .sensor-card h3 {
            font-size: 0.7em;
            color: #667eea;
            margin-bottom: 6px;
            text-transform: uppercase;
        }
        .sensor-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #333;
            min-height: 35px;
        }
        .sensor-unit {
            font-size: 0.65em;
            color: #666;
            margin-top: 3px;
        }
        
        .graph-section {
            margin: 25px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        .graph-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .graph-controls label {
            font-weight: bold;
            color: #667eea;
            min-width: 80px;
        }
        .graph-controls select {
            flex: 1;
            padding: 10px;
            font-size: 1em;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            cursor: pointer;
        }
        .graph {
            width: 100%;
            height: 180px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .dtc-item {
            background: #fff4e6;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #f44336;
        }
        .dtc-code {
            font-size: 1.5em;
            font-weight: bold;
            color: #f44336;
        }
        .log-box {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.75em;
            max-height: 180px;
            overflow-y: auto;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚ö° PROPART DIAGNOSTIC PRO</h1>
        <p>Fernando Mill√°n | 777 683 8196 | 221 956 7392</p>
    </div>

    <div class="container">
        <!-- CONEXI√ìN -->
        <div class="card">
            <h2>üì° Conexi√≥n Bluetooth OBD2</h2>
            <div class="status-box" id="status">üî¥ DESCONECTADO</div>
            
            <button class="btn-primary" id="btnConnect">üîç CONECTAR BLUETOOTH</button>
            <button class="btn-danger hidden" id="btnDisconnect">‚ùå DESCONECTAR</button>
            <button class="btn-warning hidden" id="btnDTC">üìã LEER C√ìDIGOS DTC</button>
            <button class="btn-danger hidden" id="btnClear">üóëÔ∏è BORRAR C√ìDIGOS</button>
            
            <div id="dtcResults" class="hidden">
                <h3 style="color: #ff9800; margin: 20px 0;">C√≥digos de Falla:</h3>
                <div id="dtcList"></div>
            </div>
        </div>

        <!-- SENSORES (12 TOTALES) -->
        <div class="card">
            <h2>üìä Sensores en Tiempo Real (12 Sensores)</h2>
            <p style="color: #666; margin-bottom: 15px;">Todos los sensores actualiz√°ndose cada 2 segundos</p>
            
            <div class="sensor-grid">
                <div class="sensor-card"><h3>RPM</h3><div class="sensor-value" id="rpm">----</div></div>
                <div class="sensor-card"><h3>Velocidad</h3><div class="sensor-value" id="speed">----</div><div class="sensor-unit">km/h</div></div>
                <div class="sensor-card"><h3>Temp Motor</h3><div class="sensor-value" id="temp">----</div><div class="sensor-unit">¬∞C</div></div>
                <div class="sensor-card"><h3>Temp Aire</h3><div class="sensor-value" id="iat">----</div><div class="sensor-unit">¬∞C</div></div>
                <div class="sensor-card"><h3>Voltaje</h3><div class="sensor-value" id="voltage">----</div><div class="sensor-unit">V</div></div>
                <div class="sensor-card"><h3>Carga</h3><div class="sensor-value" id="load">----</div><div class="sensor-unit">%</div></div>
                <div class="sensor-card"><h3>TPS</h3><div class="sensor-value" id="tps">----</div><div class="sensor-unit">%</div></div>
                <div class="sensor-card"><h3>MAP</h3><div class="sensor-value" id="map">----</div><div class="sensor-unit">kPa</div></div>
                <div class="sensor-card"><h3>MAF</h3><div class="sensor-value" id="maf">----</div><div class="sensor-unit">g/s</div></div>
                <div class="sensor-card"><h3>O2 Sensor</h3><div class="sensor-value" id="o2">----</div><div class="sensor-unit">V</div></div>
                <div class="sensor-card"><h3>STFT</h3><div class="sensor-value" id="stft">----</div><div class="sensor-unit">%</div></div>
                <div class="sensor-card"><h3>LTFT</h3><div class="sensor-value" id="ltft">----</div><div class="sensor-unit">%</div></div>
            </div>
        </div>

        <!-- GR√ÅFICAS PERSONALIZABLES -->
        <div class="card">
            <h2>üìà Gr√°ficas Personalizables</h2>
            <p style="color: #666; margin-bottom: 15px;">
                Selecciona qu√© sensor quieres ver en cada gr√°fica. Cambias en tiempo real sin pausar.
            </p>
            
            <!-- GR√ÅFICA 1 -->
            <div class="graph-section">
                <div class="graph-controls">
                    <label>Gr√°fica 1:</label>
                    <select id="select1" onchange="updateGraphSelection()">
                        <option value="rpm" selected>RPM</option>
                        <option value="speed">Velocidad</option>
                        <option value="temp">Temperatura Motor</option>
                        <option value="iat">Temperatura Aire</option>
                        <option value="load">Carga Motor</option>
                        <option value="tps">TPS</option>
                        <option value="map">MAP</option>
                        <option value="maf">MAF</option>
                        <option value="o2">O2 Sensor</option>
                        <option value="stft">STFT</option>
                        <option value="ltft">LTFT</option>
                        <option value="voltage">Voltaje</option>
                    </select>
                </div>
                <canvas class="graph" id="graph1"></canvas>
            </div>
            
            <!-- GR√ÅFICA 2 -->
            <div class="graph-section">
                <div class="graph-controls">
                    <label>Gr√°fica 2:</label>
                    <select id="select2" onchange="updateGraphSelection()">
                        <option value="rpm">RPM</option>
                        <option value="speed">Velocidad</option>
                        <option value="temp" selected>Temperatura Motor</option>
                        <option value="iat">Temperatura Aire</option>
                        <option value="load">Carga Motor</option>
                        <option value="tps">TPS</option>
                        <option value="map">MAP</option>
                        <option value="maf">MAF</option>
                        <option value="o2">O2 Sensor</option>
                        <option value="stft">STFT</option>
                        <option value="ltft">LTFT</option>
                        <option value="voltage">Voltaje</option>
                    </select>
                </div>
                <canvas class="graph" id="graph2"></canvas>
            </div>
            
            <!-- GR√ÅFICA 3 -->
            <div class="graph-section">
                <div class="graph-controls">
                    <label>Gr√°fica 3:</label>
                    <select id="select3" onchange="updateGraphSelection()">
                        <option value="rpm">RPM</option>
                        <option value="speed">Velocidad</option>
                        <option value="temp">Temperatura Motor</option>
                        <option value="iat">Temperatura Aire</option>
                        <option value="load" selected>Carga Motor</option>
                        <option value="tps">TPS</option>
                        <option value="map">MAP</option>
                        <option value="maf">MAF</option>
                        <option value="o2">O2 Sensor</option>
                        <option value="stft">STFT</option>
                        <option value="ltft">LTFT</option>
                        <option value="voltage">Voltaje</option>
                    </select>
                </div>
                <canvas class="graph" id="graph3"></canvas>
            </div>
        </div>

        <!-- LOG -->
        <div class="card">
            <h2>üìù Log de Comunicaci√≥n</h2>
            <div class="log-box" id="logBox"></div>
        </div>
    </div>

    <script>
        const UUIDS = ['000018f0-0000-1000-8000-00805f9b34fb', '0000fff0-0000-1000-8000-00805f9b34fb'];
        let device, server, service, writeChar, notifyChar, loop;
        let allData = '', waitingDTC = false;
        
        // Datos de TODOS los sensores
        const sensorData = {
            rpm: [], speed: [], temp: [], iat: [], voltage: [], load: [],
            tps: [], map: [], maf: [], o2: [], stft: [], ltft: []
        };
        
        // Config de gr√°ficas (max values)
        const graphConfig = {
            rpm: { max: 7000, color: '#667eea', label: 'RPM' },
            speed: { max: 200, color: '#2196F3', label: 'Velocidad (km/h)' },
            temp: { max: 120, color: '#f44336', label: 'Temp Motor (¬∞C)' },
            iat: { max: 60, color: '#FF5722', label: 'Temp Aire (¬∞C)' },
            voltage: { max: 16, color: '#FFC107', label: 'Voltaje (V)' },
            load: { max: 100, color: '#4CAF50', label: 'Carga (%)' },
            tps: { max: 100, color: '#9C27B0', label: 'TPS (%)' },
            map: { max: 255, color: '#3F51B5', label: 'MAP (kPa)' },
            maf: { max: 100, color: '#00BCD4', label: 'MAF (g/s)' },
            o2: { max: 1, color: '#009688', label: 'O2 (V)' },
            stft: { max: 50, color: '#8BC34A', label: 'STFT (%)' },
            ltft: { max: 50, color: '#CDDC39', label: 'LTFT (%)' }
        };
        
        const DTC = {
            'P0036':'O2 calentador B1S2 circuito | Verificar cables, medir 5-20Œ©',
            'P0141':'O2 calentador B1S2 falla | Verificar 12V, reemplazar',
            'P0501':'VSS rango | Verificar sensor, cables',
            'P0606':'ECM error | Verificar bater√≠a, tierras',
            'P0100':'MAF circuito | Cables, limpiar',
            'P0171':'Sistema pobre | Fugas, MAF, inyectores',
            'P0300':'Fallas encendido | Buj√≠as, bobinas',
            'P0420':'Catalizador | Verificar O2'
        };

        function log(msg, color='#00ff00') {
            const box = document.getElementById('logBox');
            const time = new Date().toLocaleTimeString();
            box.innerHTML += `<div style="color:${color}">[${time}] ${msg}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        function drawGraph(canvasId, sensorKey) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const data = sensorData[sensorKey];
            const config = graphConfig[sensorKey];
            
            const ctx = canvas.getContext('2d');
            const w = canvas.width = canvas.offsetWidth;
            const h = canvas.height = canvas.offsetHeight;
            
            // Limpiar
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, w, h);
            
            // Grid
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = (h/4)*i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(w, y);
                ctx.stroke();
            }
            
            // Datos
            if (data.length < 2) return;
            
            ctx.strokeStyle = config.color;
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            
            const points = Math.min(data.length, 50);
            const stepX = w / (points - 1);
            
            for (let i = 0; i < points; i++) {
                const value = data[data.length - points + i] || 0;
                const x = i * stepX;
                const y = h - (value / config.max) * h;
                i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        function updateGraphSelection() {
            const sensor1 = document.getElementById('select1').value;
            const sensor2 = document.getElementById('select2').value;
            const sensor3 = document.getElementById('select3').value;
            
            drawGraph('graph1', sensor1);
            drawGraph('graph2', sensor2);
            drawGraph('graph3', sensor3);
        }

        function updateAllGraphs() {
            updateGraphSelection();
        }

        document.getElementById('btnConnect').addEventListener('click', async () => {
            try {
                log('Buscando dispositivo...', '#8be9fd');
                document.getElementById('status').textContent = "üîç Buscando...";
                
                device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: UUIDS
                });
                
                log('Conectando: ' + device.name, '#50fa7b');
                server = await device.gatt.connect();
                
                for (let uuid of UUIDS) {
                    try {
                        service = await server.getPrimaryService(uuid);
                        log('Servicio OK', '#50fa7b');
                        break;
                    } catch(e) {}
                }
                
                const chars = await service.getCharacteristics();
                for (let char of chars) {
                    if (char.properties.write) writeChar = char;
                    if (char.properties.notify) notifyChar = char;
                }
                
                await notifyChar.startNotifications();
                notifyChar.addEventListener('characteristicvaluechanged', handleData);
                log('Listo!', '#50fa7b');
                
                document.getElementById('status').textContent = "‚úÖ CONECTADO";
                document.getElementById('status').classList.add('connected');
                document.getElementById('btnConnect').classList.add('hidden');
                document.getElementById('btnDisconnect').classList.remove('hidden');
                document.getElementById('btnDTC').classList.remove('hidden');
                document.getElementById('btnClear').classList.remove('hidden');
                
                await send("AT Z"); await wait(1500);
                await send("AT E0"); await wait(300);
                await send("AT SP0"); await wait(500);
                
                startLoop();
                
            } catch(error) {
                log('ERROR: ' + error.message, '#ff5555');
                alert('Error: ' + error.message);
            }
        });

        document.getElementById('btnDisconnect').addEventListener('click', () => {
            if (loop) clearInterval(loop);
            if (device && device.gatt.connected) device.gatt.disconnect();
            document.getElementById('status').textContent = "üî¥ DESCONECTADO";
            document.getElementById('status').classList.remove('connected');
            document.getElementById('btnConnect').classList.remove('hidden');
            document.getElementById('btnDisconnect').classList.add('hidden');
            document.getElementById('btnDTC').classList.add('hidden');
            document.getElementById('btnClear').classList.add('hidden');
        });

        document.getElementById('btnDTC').addEventListener('click', async () => {
            if (loop) clearInterval(loop);
            allData = '';
            waitingDTC = true;
            
            document.getElementById('dtcResults').classList.remove('hidden');
            document.getElementById('dtcList').innerHTML = '<p style="text-align:center; padding:20px;">‚è≥ ESCANEANDO...</p>';
            
            log('Leyendo DTC...', '#8be9fd');
            await send("03"); await wait(1500);
            await send("03 01"); await wait(1500);
            await send("03 02"); await wait(1500);
            
            setTimeout(() => {
                waitingDTC = false;
                displayDTC();
                setTimeout(() => startLoop(), 2000);
            }, 1000);
        });

        function displayDTC() {
            log('Data: ' + allData, '#f1fa8c');
            
            const codes = new Set();
            const direct = allData.match(/[PCBU][0-9A-F]{4}/gi);
            if (direct) direct.forEach(c => codes.add(c.toUpperCase()));
            
            const hexPattern = /43[\s]+((?:[0-9A-F]{2}[\s]*)+)/gi;
            [...allData.matchAll(hexPattern)].forEach(match => {
                const hex = match[1].replace(/\s/g, '');
                for (let i = 0; i < hex.length; i += 4) {
                    const chunk = hex.substring(i, i + 4);
                    if (chunk !== '0000' && chunk.length === 4) {
                        const dtc = hexToDTC(chunk);
                        if (dtc) codes.add(dtc);
                    }
                }
            });
            
            const listEl = document.getElementById('dtcList');
            
            if (codes.size === 0) {
                listEl.innerHTML = '<p style="text-align:center; padding:30px;">‚úÖ SIN C√ìDIGOS</p>';
                log('Sin c√≥digos', '#50fa7b');
            } else {
                log('C√≥digos: ' + Array.from(codes).join(', '), '#50fa7b');
                listEl.innerHTML = Array.from(codes).map(code => {
                    const info = DTC[code] || 'C√≥digo gen√©rico';
                    return `<div class="dtc-item"><div class="dtc-code">‚ùå ${code}</div><div style="margin-top:10px;">${info}</div></div>`;
                }).join('');
            }
        }

        function hexToDTC(hex) {
            const d = parseInt(hex[0], 16);
            const p = ['P0','P1','P2','P3','C0','C1','C2','C3','B0','B1','B2','B3','U0','U1','U2','U3'];
            return p[d] + hex.substring(1);
        }

        document.getElementById('btnClear').addEventListener('click', async () => {
            if (confirm('¬øBorrar c√≥digos?')) {
                if (loop) clearInterval(loop);
                await send("04");
                document.getElementById('dtcResults').classList.add('hidden');
                log('C√≥digos borrados', '#50fa7b');
                alert('‚úÖ C√≥digos borrados');
                await wait(500);
                startLoop();
            }
        });

        async function send(cmd) {
            if (!writeChar) return;
            await writeChar.writeValue(new TextEncoder().encode(cmd + "\r"));
            log('TX: ' + cmd, '#bd93f9');
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function handleData(event) {
            const value = new TextDecoder().decode(event.target.value).trim();
            if (!value || value === '>') return;
            
            log('RX: ' + value, '#f1fa8c');
            
            if (waitingDTC) {
                allData += value + ' ';
                return;
            }
            
            // RPM
            if (value.includes('41 0C')) {
                const hex = value.replace(/\s/g, '').substring(4, 8);
                if (hex.length === 4) {
                    const rpm = Math.round(parseInt(hex, 16) / 4);
                    document.getElementById('rpm').textContent = rpm;
                    sensorData.rpm.push(rpm);
                    if (sensorData.rpm.length > 50) sensorData.rpm.shift();
                    updateAllGraphs();
                }
            }
            
            // Velocidad
            if (value.includes('41 0D')) {
                const hex = value.replace(/\s/g, '').substring(4, 6);
                if (hex.length === 2) {
                    const speed = parseInt(hex, 16);
                    document.getElementById('speed').textContent = speed;
                    sensorData.speed.push(speed);
                    if (sensorData.speed.length > 50) sensorData.speed.shift();
                    updateAllGraphs();
                }
            }
            
            // Temp Motor
            if (value.includes('41 05')) {
                const hex = value.replace(/\s/g, '').substring(4, 6);
                if (hex.length === 2) {
                    const temp = parseInt(hex, 16) - 40;
                    document.getElementById('temp').textContent = temp;
                    sensorData.temp.push(temp);
                    if (sensorData.temp.length > 50) sensorData.temp.shift();
                    updateAllGraphs();
                }
            }
            
            // Temp Aire (IAT)
            if (value.includes('41 0F')) {
                const hex = value.replace(/\s/g, '').substring(4, 6);
                if (hex.length === 2) {
                    const iat = parseInt(hex, 16) - 40;
                    document.getElementById('iat').textContent = iat;
                    sensorData.iat.push(iat);
                    if (sensorData.iat.length > 50) sensorData.iat.shift();
                    updateAllGraphs();
                }
            }
            
            // Voltaje
            if (value.includes('V')) {
                const match = value.match(/(\d+\.?\d*)/);
                if (match) {
                    const voltage = parseFloat(match[1]);
                    document.getElementById('voltage').textContent = voltage.toFixed(1);
                    sensorData.voltage.push(voltage);
                    if (sensorData.voltage.length > 50) sensorData.voltage.shift();
                    updateAllGraphs();
                }
            }
            
            // Carga
            if (value.includes('41 04')) {
                const hex = value.replace(/\s/g, '').substring(4, 6);
                if (hex.length === 2) {
                    const load = Math.round((parseInt(hex, 16) * 100) / 255);
                    document.getElementById('load').textContent = load;
                    sensorData.load.push(load);
                    if (sensorData.load.length > 50) sensorData.load.shift();
                    updateAllGraphs();
                }
            }
            
            // TPS
            if (value.includes('41 11')) {
                const hex = value.replace(/\s/g, '').substring(4, 6);
                if (hex.length === 2) {
                    const tps = Math.round((parseInt(hex, 16) * 100) / 255);
                    document.getElementById('tps').textContent = tps;
                    sensorData.tps.push(tps);
                    if (sensorData.tps.length > 50) sensorData.tps.shift();
                    updateAllGraphs();
                }
            }
            
            // MAP
            if (value.includes('41 0B')) {
                const hex = value.replace(/\s/g, '').substring(4, 6);
                if (hex.length === 2) {
                    const map = parseInt(hex, 16);
                    document.getElementById('map').textContent = map;
                    sensorData.map.push(map);
                    if (sensorData.map.length > 50) sensorData.map.shift();
                    updateAllGraphs();
                }
            }
            
            // MAF
            if (value.includes('41 10')) {
                const hex = value.replace(/\s/g, '').substring(4, 8);
                if (hex.length === 4) {
                    const maf = parseInt(hex, 16) / 100;
                    document.getElementById('maf').textContent = maf.toFixed(1);
                    sensorData.maf.push(maf);
                    if (sensorData.maf.length > 50) sensorData.maf.shift();
                    updateAllGraphs();
                }
            }
            
            // O2
            if (value.includes('41 14')) {
                const hex = value.replace(/\s/g, '').substring(4, 6);
                if (hex.length === 2) {
                    const o2 = parseInt(hex, 16) / 200;
                    document.getElementById('o2').textContent = o2.toFixed(2);
                    sensorData.o2.push(o2);
                    if (sensorData.o2.length > 50) sensorData.o2.shift();
                    updateAllGraphs();
                }
            }
            
            // STFT
            if (value.includes('41 06')) {
                const hex = value.replace(/\s/g, '').substring(4, 6);
                if (hex.length === 2) {
                    const stft = ((parseInt(hex, 16) - 128) * 100 / 128).toFixed(1);
                    document.getElementById('stft').textContent = stft;
                    sensorData.stft.push(parseFloat(stft));
                    if (sensorData.stft.length > 50) sensorData.stft.shift();
                    updateAllGraphs();
                }
            }
            
            // LTFT
            if (value.includes('41 07')) {
                const hex = value.replace(/\s/g, '').substring(4, 6);
                if (hex.length === 2) {
                    const ltft = ((parseInt(hex, 16) - 128) * 100 / 128).toFixed(1);
                    document.getElementById('ltft').textContent = ltft;
                    sensorData.ltft.push(parseFloat(ltft));
                    if (sensorData.ltft.length > 50) sensorData.ltft.shift();
                    updateAllGraphs();
                }
            }
        }

        function startLoop() {
            loop = setInterval(async () => {
                await send("010C"); await wait(80);
                await send("010D"); await wait(80);
                await send("0105"); await wait(80);
                await send("010F"); await wait(80);
                await send("0104"); await wait(80);
                await send("0111"); await wait(80);
                await send("010B"); await wait(80);
                await send("0110"); await wait(80);
                await send("0114"); await wait(80);
                await send("0106"); await wait(80);
                await send("0107"); await wait(80);
                await send("ATRV");
            }, 2000);
        }

        log('Sistema listo', '#50fa7b');
    </script>
</body>
</html>
